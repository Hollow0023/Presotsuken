<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>プラン管理</title>
    <link rel="stylesheet" href="/css/plan_manager.css"> </head>
<body>
    <div class="left-panel">
        <div class="list-header">
            <h1>
                プラン一覧 (店舗ID: <span id="currentStoreIdDisplay"></span>)
            </h1>
        </div>
        <a href="/">← トップに戻る</a>
        <br><button id="newPlanBtn" class="primary-button">新しいプランを追加</button><br>
        
        <p th:if="${message}" th:text="${message}"
            style="color: green; margin-bottom: 15px;"></p>

        <div id="planList" class="list-container">
            <div th:each="plan : ${plans}" th:data-plan-id="${plan.planId}"
                class="plan-item">
                <strong th:text="${plan.planName}">プラン名</strong><br /> <small
                    th:text="${plan.planDescription}"></small>
                <div style="font-size: 0.8em; color: #555;">
                    紐づくグループ: <span
                        th:each="groupName, iterStat : ${plan.menuGroupNames}"> <span
                        th:text="${groupName}"></span><span th:if="${!iterStat.last}">,
                    </span>
                    </span> <span th:if="${#lists.isEmpty(plan.menuGroupNames)}">なし</span>
                </div>
            </div>
            <p th:if="${#lists.isEmpty(plans)}"
                style="text-align: center; color: #777;">プランが登録されていません。</p>
        </div>
    </div>

    <div class="right-panel">
        <h2 id="formTitle">新規プラン作成</h2>
        <form id="planForm" th:action="@{/admin/plans/create}"
            th:object="${planForm}" method="post">
            <input type="hidden" id="planIdInput" th:field="*{planId}" /> <input
                type="hidden" id="storeIdFormInput" th:field="*{storeId}" />
            <div class="form-group">
                <label for="planNameInput">プラン名:</label> <input type="text"
                    id="planNameInput" th:field="*{planName}" required />
            </div>
            <div class="form-group">
                <label for="planDescriptionInput">説明:</label>
                <textarea id="planDescriptionInput" th:field="*{planDescription}"></textarea>
            </div>
            <div class="form-group">
                <label>紐づくメニューグループ:</label>
                <div id="menuGroupSelectsContainer" class="checkbox-group">
                    </div>
                <button type="button" id="addMenuGroupBtn" class="add-group-btn">グループ追加</button>
            </div>
            <div class="button-group">
                <button type="submit" id="submitBtn" class="primary">作成</button>
                <button type="button" id="resetBtn" class="secondary">リセット</button>
                <button type="button" id="deleteBtn" class="danger"
                    style="display: none;">削除</button>
            </div>
        </form>
    </div>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="/js/utils.js"></script>
    <script src="/js/plan-manager.js"></script>
    <script th:inline="javascript">
        /*<![CDATA[*/
        const initialPlans = /*[[${plans}]]*/ [];
        const allMenuGroups = /*[[${allMenuGroups}]]*/ [];
        
        // ページロード後に初期化
        document.addEventListener('DOMContentLoaded', function() {
            initializePlanManager(initialPlans, allMenuGroups);
        });
        /*]]>*/
    </script>

</body>
</html>
