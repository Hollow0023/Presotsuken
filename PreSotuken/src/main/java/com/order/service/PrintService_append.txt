    
    /**
     * Print official receipt (領収書)
     * This method prints a formal receipt with tax breakdown
     */
    public void printOfficialReceipt(Receipt receipt, Integer storeId) {
        // Get store info
        Store store = receipt.getPayment().getStore();
        String storeName = store.getStoreName();
        
        // Create JSON commands array
        ArrayNode commands = objectMapper.createArrayNode();
        
        // Initial setup
        commands.add(createSoundCommand("pattern_a", 1));
        commands.add(createAddTextLangCommand("ja"));
        commands.add(createAddTextFontCommand("FONT_A"));
        
        // Header - centered title
        commands.add(createTextAlignCommand("center"));
        commands.add(createTextDoubleCommand(true, true));
        commands.add(createTextCommand("領収書"));
        commands.add(createTextDoubleCommand(false, false));
        commands.add(createFeedUnitCommand(10));
        
        // Store name and issue info
        commands.add(createTextAlignCommand("left"));
        commands.add(createTextCommand("発行店舗: " + storeName));
        commands.add(createFeedUnitCommand(5));
        
        String issueDateTime = receipt.getIssuedAt().format(DateTimeFormatter.ofPattern("yyyy/MM/dd HH:mm"));
        commands.add(createTextCommand("発行日時: " + issueDateTime));
        commands.add(createFeedUnitCommand(5));
        
        commands.add(createTextCommand("領収書番号: " + receipt.getReceiptNo()));
        commands.add(createFeedUnitCommand(5));
        
        // Reprint indicator
        if (receipt.getReprintCount() > 0) {
            commands.add(createTextCommand("【再印字 " + receipt.getReprintCount() + "回目】"));
            commands.add(createFeedUnitCommand(5));
        }
        
        commands.add(createTextCommand("-".repeat(RECEIPT_TOTAL_WIDTH_HALF)));
        commands.add(createFeedUnitCommand(10));
        
        // Total amount - large and centered
        commands.add(createTextAlignCommand("center"));
        commands.add(createTextDoubleCommand(true, true));
        commands.add(createTextCommand("合計金額（税込）"));
        commands.add(createFeedUnitCommand(5));
        String totalAmount = "\\" + String.format("%,d", receipt.getTotalAmount().longValue());
        commands.add(createTextCommand(totalAmount));
        commands.add(createTextDoubleCommand(false, false));
        commands.add(createFeedUnitCommand(10));
        
        // Tax breakdown
        commands.add(createTextAlignCommand("left"));
        commands.add(createTextCommand("-".repeat(RECEIPT_TOTAL_WIDTH_HALF)));
        commands.add(createFeedUnitCommand(5));
        commands.add(createTextCommand("【税率別内訳】"));
        commands.add(createFeedUnitCommand(5));
        
        // 10% tax rate breakdown
        if (receipt.getNetAmount10().compareTo(BigDecimal.ZERO) > 0 || 
            receipt.getTaxAmount10().compareTo(BigDecimal.ZERO) > 0) {
            commands.add(createTextCommand("10%対象"));
            commands.add(createFeedUnitCommand(3));
            
            String net10 = "\\" + String.format("%,d", receipt.getNetAmount10().longValue());
            commands.add(createTextCommand(formatToLeftAndRight("  税抜", net10, RECEIPT_TOTAL_WIDTH_HALF)));
            commands.add(createFeedUnitCommand(3));
            
            String tax10 = "\\" + String.format("%,d", receipt.getTaxAmount10().longValue());
            commands.add(createTextCommand(formatToLeftAndRight("  税額", tax10, RECEIPT_TOTAL_WIDTH_HALF)));
            commands.add(createFeedUnitCommand(3));
            
            String total10 = "\\" + String.format("%,d", 
                receipt.getNetAmount10().add(receipt.getTaxAmount10()).longValue());
            commands.add(createTextCommand(formatToLeftAndRight("  税込", total10, RECEIPT_TOTAL_WIDTH_HALF)));
            commands.add(createFeedUnitCommand(5));
        }
        
        // 8% tax rate breakdown
        if (receipt.getNetAmount8().compareTo(BigDecimal.ZERO) > 0 || 
            receipt.getTaxAmount8().compareTo(BigDecimal.ZERO) > 0) {
            commands.add(createTextCommand("8%対象"));
            commands.add(createFeedUnitCommand(3));
            
            String net8 = "\\" + String.format("%,d", receipt.getNetAmount8().longValue());
            commands.add(createTextCommand(formatToLeftAndRight("  税抜", net8, RECEIPT_TOTAL_WIDTH_HALF)));
            commands.add(createFeedUnitCommand(3));
            
            String tax8 = "\\" + String.format("%,d", receipt.getTaxAmount8().longValue());
            commands.add(createTextCommand(formatToLeftAndRight("  税額", tax8, RECEIPT_TOTAL_WIDTH_HALF)));
            commands.add(createFeedUnitCommand(3));
            
            String total8 = "\\" + String.format("%,d", 
                receipt.getNetAmount8().add(receipt.getTaxAmount8()).longValue());
            commands.add(createTextCommand(formatToLeftAndRight("  税込", total8, RECEIPT_TOTAL_WIDTH_HALF)));
            commands.add(createFeedUnitCommand(5));
        }
        
        // Verification total
        commands.add(createTextCommand("-".repeat(RECEIPT_TOTAL_WIDTH_HALF)));
        commands.add(createFeedUnitCommand(5));
        String verifyTotal = "\\" + String.format("%,d", receipt.getTotalAmount().longValue());
        commands.add(createTextCommand(formatToLeftAndRight("合計（検算用）", verifyTotal, RECEIPT_TOTAL_WIDTH_HALF)));
        commands.add(createFeedUnitCommand(10));
        
        // Footer info
        commands.add(createTextCommand("-".repeat(RECEIPT_TOTAL_WIDTH_HALF)));
        commands.add(createFeedUnitCommand(5));
        commands.add(createTextCommand("会計ID: " + receipt.getPayment().getPaymentId()));
        commands.add(createFeedUnitCommand(3));
        commands.add(createTextCommand("領収書ID: " + receipt.getReceiptId()));
        commands.add(createFeedUnitCommand(3));
        commands.add(createTextCommand("発行者: " + receipt.getIssuedBy().getUserName()));
        commands.add(createFeedUnitCommand(10));
        
        // QR code with receipt number
        commands.add(createTextAlignCommand("center"));
        ObjectNode qrCmd = objectMapper.createObjectNode();
        qrCmd.put("api", "addSymbol");
        qrCmd.put("type", "pdf417_standard");
        qrCmd.put("level", "level_0");
        qrCmd.put("width", 3);
        qrCmd.put("height", 3);
        qrCmd.put("data", receipt.getReceiptNo());
        commands.add(qrCmd);
        
        commands.add(createFeedUnitCommand(15));
        commands.add(createCutCommand("feed"));
        
        // Get printer for receipts
        PrinterConfig printer = printerConfigRepository.findByStoreIdAndReceiptOutput(storeId, true);
        if (printer == null) {
            throw new IllegalStateException("No receipt printer configured for store: " + storeId);
        }
        String printerIp = printer.getPrinterIp();
        
        // Send to frontend for printing
        sendPrintCommandsToFrontend(printerIp, receipt.getPayment().getVisit().getSeat().getSeatId(), commands.toString());
    }
